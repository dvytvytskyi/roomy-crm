# üîÑ –ë–Ü–ó–ù–ï–°-–ü–†–û–¶–ï–°–ò –°–ò–°–¢–ï–ú–ò ROOMY CRM
## –°–µ—Ä–µ–¥–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—ó - –í–∑–∞—î–º–æ–¥—ñ—è —Å—É—Ç–Ω–æ—Å—Ç–µ–π —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è

---

## üìã **–ó–ê–ì–ê–õ–¨–ù–ê –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø**

### üéØ **–ú–ï–¢–ê –î–û–ö–£–ú–ï–ù–¢–£**
–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –∫–ª—é—á–æ–≤–∏—Ö –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤ —Å–∏—Å—Ç–µ–º–∏ Roomy CRM, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—Ç—å –≤–∑–∞—î–º–æ–¥—ñ—é –º—ñ–∂ —Å—É—Ç–Ω–æ—Å—Ç—è–º–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é –ø—Ä–æ—Ü–µ—Å—ñ–≤, —Ç—Ä–∏–≥–µ—Ä–∏ —Ç–∞ –≤–ø–ª–∏–≤ –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—ñ–≤ –Ω–∞ —ñ–Ω—à—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∏—Å—Ç–µ–º–∏.

### üîó **–ó–í'–Ø–ó–ö–ò –ú–Ü–ñ –ü–†–û–¶–ï–°–ê–ú–ò**
–ö–æ–∂–µ–Ω –ø—Ä–æ—Ü–µ—Å –Ω–µ —ñ—Å–Ω—É—î —ñ–∑–æ–ª—å–æ–≤–∞–Ω–æ - –∑–º—ñ–Ω–∏ –≤ –æ–¥–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —ñ–Ω—à—ñ, —Å—Ç–≤–æ—Ä—é—é—á–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—É –µ–∫–æ—Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è.

---

## üîÑ **1. –ü–û–í–ù–ò–ô –ñ–ò–¢–¢–Ñ–í–ò–ô –¶–ò–ö–õ –£–°–ü–Ü–®–ù–û–ì–û –ë–†–û–ù–Æ–í–ê–ù–ù–Ø**

### üìÖ **–ï—Ç–∞–ø 1: –ü–æ—à—É–∫ —Ç–∞ –≤–∏–±—ñ—Ä –æ–±'—î–∫—Ç–∞ –≥–æ—Å—Ç–µ–º**

**–ü—Ä–æ—Ü–µ—Å:**
1. **–ì—ñ—Å—Ç—å** –∑–¥—ñ–π—Å–Ω—é—î –ø–æ—à—É–∫ –æ–±'—î–∫—Ç–∞ —á–µ—Ä–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î **Property.isPublished = true** —Ç–∞ **Property.isActive = true**
3. –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –≤ **Scheduler** –Ω–∞ –≤–∏–±—Ä–∞–Ω—ñ –¥–∞—Ç–∏
4. –°–∏—Å—Ç–µ–º–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î —Ü—ñ–Ω—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—ñ —Ç–∞ –ø—Ä–æ–º–æ-–∞–∫—Ü—ñ–π

**–¢—Ä–∏–≥–µ—Ä–∏:**
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü—ñ—è–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ü—ñ–Ω
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Ä–º—ñ–Ω—É –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è

**–°—Ç–≤–æ—Ä—é–≤–∞–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ:**
- –¢–∏–º—á–∞—Å–æ–≤–∞ **Reservation** –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING`
- **Transaction** –∑ —Ç–∏–ø–æ–º `RESERVATION_FEE` (—è–∫—â–æ –ø–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞)

### üìÖ **–ï—Ç–∞–ø 2: –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è**

**–ü—Ä–æ—Ü–µ—Å:**
1. **Reservation.status** –∑–º—ñ–Ω—é—î—Ç—å—Å—è –∑ `PENDING` –Ω–∞ `CONFIRMED`
2. **PaymentStatus** –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `PAID` (—è–∫—â–æ –ø–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–∞)
3. **GuestStatus** –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ `BOOKED`

**–ö—Ä–∏—Ç–∏—á–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏:**
```typescript
// –ü—Å–µ–≤–¥–æ–∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó
if (reservation.status === 'CONFIRMED') {
  // 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è
  createCleaningTask({
    propertyId: reservation.propertyId,
    scheduledDate: reservation.checkIn - 1 day,
    type: 'Pre-Arrival',
    status: 'Scheduled',
    priority: 'High'
  })
  
  // 2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏
  createMaintenanceTask({
    propertyId: reservation.propertyId,
    scheduledDate: reservation.checkIn - 2 hours,
    type: 'INSPECTION',
    status: 'Scheduled',
    priority: 'High'
  })
  
  // 3. –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –¥–∞—Ç –≤ Scheduler
  blockPropertyDates({
    propertyId: reservation.propertyId,
    startDate: reservation.checkIn,
    endDate: reservation.checkOut,
    reason: 'RESERVATION'
  })
  
  // 4. –í—ñ–¥–ø—Ä–∞–≤–∫–∞ email –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
  sendEmail({
    to: reservation.guest.email,
    template: 'CONFIRMATION',
    data: reservation
  })
}
```

**–°—Ç–≤–æ—Ä—é–≤–∞–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ:**
- **Cleaning** task (Pre-Arrival)
- **Maintenance** task (Inspection)
- **Scheduler** event (–±–ª–æ–∫—É—é—á–∏–π)
- **Message** (email –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è)
- **Notification** (–¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞)

### üìÖ **–ï—Ç–∞–ø 3: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±'—î–∫—Ç–∞**

**–ü—Ä–æ—Ü–µ—Å:**
1. **Cleaning** task –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞ 1 –¥–µ–Ω—å –¥–æ –∑–∞—Å–µ–ª–µ–Ω–Ω—è
2. **Maintenance** task –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞ 2 –≥–æ–¥–∏–Ω–∏ –¥–æ –∑–∞—Å–µ–ª–µ–Ω–Ω—è
3. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–±–æ—Ö –∑–∞–≤–¥–∞–Ω—å **Property** —Å—Ç–∞—î –≥–æ—Ç–æ–≤–∏–º –¥–æ –∑–∞—Å–µ–ª–µ–Ω–Ω—è

**–¢—Ä–∏–≥–µ—Ä–∏:**
```typescript
// –ö–æ–ª–∏ Cleaning task –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è
if (cleaningTask.status === 'COMPLETED') {
  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ
  updateProperty({
    id: cleaningTask.propertyId,
    isReadyForCheckIn: true
  })
  
  // –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≥–æ—Å—Ç—è
  sendMessage({
    to: reservation.guest,
    type: 'SMS',
    content: 'Your property is ready for check-in!'
  })
}

// –ö–æ–ª–∏ Maintenance task –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è
if (maintenanceTask.status === 'COMPLETED') {
  // –§—ñ–Ω–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ
  if (allTasksCompleted(reservation.propertyId)) {
    markPropertyReady(reservation.propertyId)
  }
}
```

### üìÖ **–ï—Ç–∞–ø 4: –ó–∞—Å–µ–ª–µ–Ω–Ω—è –≥–æ—Å—Ç—è**

**–ü—Ä–æ—Ü–µ—Å:**
1. –ì—ñ—Å—Ç—å –ø—Ä–∏–±—É–≤–∞—î –Ω–∞ –æ–±'—î–∫—Ç
2. **Reservation.guestStatus** –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `CHECKED_IN`
3. **Reservation.checkInTime** —Ñ—ñ–∫—Å—É—î—Ç—å—Å—è
4. –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è **Cleaning** task –Ω–∞ Post-Checkout

**–¢—Ä–∏–≥–µ—Ä–∏:**
```typescript
if (reservation.guestStatus === 'CHECKED_IN') {
  // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –ø—ñ—Å–ª—è –≤–∏—Å–µ–ª–µ–Ω–Ω—è
  createCleaningTask({
    propertyId: reservation.propertyId,
    scheduledDate: reservation.checkOut + 2 hours,
    type: 'Post-Checkout',
    status: 'Scheduled',
    priority: 'High'
  })
  
  // –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –∑–∞—Å–µ–ª–µ–Ω–Ω—è
  notifyManager({
    message: `Guest ${reservation.guest.name} checked in at ${reservation.property.name}`
  })
}
```

### üìÖ **–ï—Ç–∞–ø 5: –ü—Ä–æ–∂–∏–≤–∞–Ω–Ω—è —Ç–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è**

**–ü—Ä–æ—Ü–µ—Å:**
1. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–Ω—É –æ–±'—î–∫—Ç–∞
2. –û–±—Ä–æ–±–∫–∞ –∑–∞–ø–∏—Ç—ñ–≤ –≥–æ—Å—Ç—è
3. –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ø–æ—Å–ª—É–≥

**–ú–æ–∂–ª–∏–≤—ñ —Ç—Ä–∏–≥–µ—Ä–∏:**
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è **Maintenance** –∑–∞–≤–¥–∞–Ω—å –∑–∞ –∑–∞–ø–∏—Ç–æ–º
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è **Cleaning** –∑–∞–≤–¥–∞–Ω—å (Mid-Stay)
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è **Reservation** –Ω–æ—Ç–∞—Ç–æ–∫

### üìÖ **–ï—Ç–∞–ø 6: –í–∏—Å–µ–ª–µ–Ω–Ω—è —Ç–∞ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏**

**–ü—Ä–æ—Ü–µ—Å:**
1. **Reservation.guestStatus** –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `CHECKED_OUT`
2. **Reservation.checkOutTime** —Ñ—ñ–∫—Å—É—î—Ç—å—Å—è
3. –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è **Cleaning** task (Post-Checkout)
4. –†–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è —Ñ—ñ–Ω–∞–ª—å–Ω–∞ —Å—É–º–∞ –¥–æ –≤–∏–ø–ª–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫—É

**–§—ñ–Ω–∞–Ω—Å–æ–≤—ñ —Ç—Ä–∏–≥–µ—Ä–∏:**
```typescript
if (reservation.guestStatus === 'CHECKED_OUT') {
  // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∏–ø–ª–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫—É
  const ownerPayout = calculateOwnerPayout({
    totalAmount: reservation.totalAmount,
    commission: reservation.commission,
    cleaningCost: cleaningTask.cost,
    maintenanceCost: maintenanceTask.cost
  })
  
  // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –≤–∏–ø–ª–∞—Ç–∏
  createTransaction({
    type: 'OWNER_PAYOUT',
    amount: ownerPayout,
    userId: reservation.property.ownerId,
    reservationId: reservation.id,
    status: 'PENDING'
  })
  
  // –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –≤–∏–ø–ª–∞—Ç–∏
  scheduleOwnerPayout({
    ownerId: reservation.property.ownerId,
    amount: ownerPayout,
    scheduledDate: getNextPayoutDate(reservation.property.owner.payoutSchedule)
  })
}
```

**–°—Ç–≤–æ—Ä—é–≤–∞–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ:**
- **Transaction** (OWNER_PAYOUT)
- **Cleaning** task (Post-Checkout)
- **Notification** (–¥–ª—è –≤–ª–∞—Å–Ω–∏–∫–∞)

---

## ‚ùå **2. –ü–†–û–¶–ï–° –°–ö–ê–°–£–í–ê–ù–ù–Ø –ë–†–û–ù–Æ–í–ê–ù–ù–Ø**

### üö´ **–ï—Ç–∞–ø 1: –Ü–Ω—ñ—Ü—ñ–∞—Ü—ñ—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è**

**–ü—Ä–æ—Ü–µ—Å:**
1. –ì—ñ—Å—Ç—å –∞–±–æ –º–µ–Ω–µ–¥–∂–µ—Ä —ñ–Ω—ñ—Ü—ñ—é—î —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
2. **Reservation.status** –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `CANCELLED`
3. **Reservation.cancellationReason** —Ñ—ñ–∫—Å—É—î—Ç—å—Å—è
4. **Reservation.cancellationDate** –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è

**–ö—Ä–∏—Ç–∏—á–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏:**
```typescript
if (reservation.status === 'CANCELLED') {
  // 1. –°–∫–∞—Å—É–≤–∞–Ω–Ω—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å
  cancelRelatedTasks({
    reservationId: reservation.id,
    types: ['CLEANING', 'MAINTENANCE']
  })
  
  // 2. –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –¥–∞—Ç –≤ Scheduler
  unblockPropertyDates({
    propertyId: reservation.propertyId,
    startDate: reservation.checkIn,
    endDate: reservation.checkOut
  })
  
  // 3. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —à—Ç—Ä–∞—Ñ—É –∑–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
  const cancellationFee = calculateCancellationFee({
    totalAmount: reservation.totalAmount,
    cancellationDate: new Date(),
    checkInDate: reservation.checkIn,
    cancellationPolicy: reservation.property.cancellationPolicy
  })
  
  // 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
  createTransaction({
    type: 'REFUND',
    amount: reservation.totalAmount - cancellationFee,
    userId: reservation.guestId,
    reservationId: reservation.id,
    status: 'PENDING'
  })
  
  // 5. –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞—Ü—ñ–∫–∞–≤–ª–µ–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω
  notifyStakeholders({
    guest: reservation.guest,
    owner: reservation.property.owner,
    manager: reservation.assignedManager
  })
}
```

### üîÑ **–ï—Ç–∞–ø 2: –û–±—Ä–æ–±–∫–∞ –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å—É—Ç–Ω–æ—Å—Ç–µ–π**

**–ü—Ä–æ—Ü–µ—Å–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è:**

**Cleaning Tasks:**
```typescript
// –í—Å—ñ –ø–æ–≤'—è–∑–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è —Å–∫–∞—Å–æ–≤—É—é—Ç—å—Å—è
const cleaningTasks = getCleaningTasksByReservation(reservation.id)
cleaningTasks.forEach(task => {
  if (task.status === 'SCHEDULED' || task.status === 'PENDING') {
    updateCleaningTask(task.id, { status: 'CANCELLED' })
  }
})
```

**Maintenance Tasks:**
```typescript
// –í—Å—ñ –ø–æ–≤'—è–∑–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è —Å–∫–∞—Å–æ–≤—É—é—Ç—å—Å—è
const maintenanceTasks = getMaintenanceTasksByReservation(reservation.id)
maintenanceTasks.forEach(task => {
  if (task.status === 'SCHEDULED' || task.status === 'PENDING') {
    updateMaintenanceTask(task.id, { status: 'CANCELLED' })
  }
})
```

**Scheduler Events:**
```typescript
// –ë–ª–æ–∫—É–≤–∞–ª—å–Ω—ñ –ø–æ–¥—ñ—ó –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è
const schedulerEvents = getSchedulerEventsByReservation(reservation.id)
schedulerEvents.forEach(event => {
  if (event.eventType === 'RESERVATION_BLOCK') {
    deleteSchedulerEvent(event.id)
  }
})
```

### üí∞ **–ï—Ç–∞–ø 3: –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏**

**–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è:**
```typescript
const calculateRefund = (reservation) => {
  const cancellationPolicy = reservation.property.cancellationPolicy
  const daysUntilCheckIn = getDaysDifference(new Date(), reservation.checkIn)
  
  let refundPercentage = 0
  
  switch (cancellationPolicy) {
    case 'FLEXIBLE':
      if (daysUntilCheckIn >= 1) refundPercentage = 100
      else if (daysUntilCheckIn >= 0) refundPercentage = 50
      break
      
    case 'MODERATE':
      if (daysUntilCheckIn >= 5) refundPercentage = 100
      else if (daysUntilCheckIn >= 1) refundPercentage = 50
      break
      
    case 'STRICT':
      if (daysUntilCheckIn >= 7) refundPercentage = 50
      break
  }
  
  return {
    refundAmount: reservation.totalAmount * (refundPercentage / 100),
    cancellationFee: reservation.totalAmount * ((100 - refundPercentage) / 100),
    refundPercentage
  }
}
```

**–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π:**
```typescript
// –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –≥–æ—Å—Ç—é
createTransaction({
  type: 'REFUND',
  amount: refundAmount,
  userId: reservation.guestId,
  reservationId: reservation.id,
  status: 'PENDING',
  description: `Refund for cancelled reservation ${reservation.id}`
})

// –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è —à—Ç—Ä–∞—Ñ—É (—è–∫—â–æ —î)
if (cancellationFee > 0) {
  createTransaction({
    type: 'CANCELLATION_FEE',
    amount: cancellationFee,
    userId: reservation.guestId,
    reservationId: reservation.id,
    status: 'COMPLETED',
    description: `Cancellation fee for reservation ${reservation.id}`
  })
}
```

---

## üîß **3. –£–ü–†–ê–í–õ–Ü–ù–ù–Ø –¢–ï–•–ù–Ü–ß–ù–ò–ú –û–ë–°–õ–£–ì–û–í–£–í–ê–ù–ù–Ø–ú**

### üõ†Ô∏è **–ï—Ç–∞–ø 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—è–≤–∫–∏ –Ω–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è**

**–ü—Ä–æ—Ü–µ—Å:**
1. –ú–µ–Ω–µ–¥–∂–µ—Ä, –≥—ñ—Å—Ç—å –∞–±–æ —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–≤–æ—Ä—é—î **Maintenance** –∑–∞—è–≤–∫—É
2. **Maintenance.type** –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è (REPAIR, INSPECTION, EMERGENCY, —Ç–æ—â–æ)
3. **Maintenance.priority** –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–±–æ –≤—Ä—É—á–Ω—É
4. **Maintenance.status** –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ `PENDING`

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É:**
```typescript
const assignPriority = (maintenanceType, description) => {
  // –ê–≤–∞—Ä—ñ–π–Ω—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó - –Ω–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
  if (maintenanceType === 'EMERGENCY') return 'URGENT'
  
  // –ö—Ä–∏—Ç–∏—á–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ - –≤–∏—Å–æ–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
  const criticalKeywords = ['water', 'electricity', 'heating', 'security']
  if (criticalKeywords.some(keyword => description.toLowerCase().includes(keyword))) {
    return 'HIGH'
  }
  
  // –ó–≤–∏—á–∞–π–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
  return 'NORMAL'
}
```

### üë∑ **–ï—Ç–∞–ø 2: –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–≤—Ü—è**

**–ü—Ä–æ—Ü–µ—Å –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:**
```typescript
const assignMaintenanceStaff = (maintenanceTask) => {
  // 1. –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö —Ä–æ–±—ñ—Ç
  const requiredSkills = getRequiredSkills(maintenanceTask.type)
  
  // 2. –ü–æ—à—É–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç—ñ–≤
  const availableStaff = getAvailableMaintenanceStaff({
    skills: requiredSkills,
    date: maintenanceTask.scheduledDate,
    location: maintenanceTask.property.location
  })
  
  // 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–±–æ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É
  if (availableStaff.length === 1) {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
    return assignTask(maintenanceTask.id, availableStaff[0].id)
  } else if (availableStaff.length > 1) {
    // –ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É –≤–∏–±—ñ—Ä
    notifyManager({
      type: 'STAFF_ASSIGNMENT_NEEDED',
      taskId: maintenanceTask.id,
      availableStaff: availableStaff,
      message: `Multiple staff available for ${maintenanceTask.type} task`
    })
  } else {
    // –ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç—ñ–≤
    notifyManager({
      type: 'NO_STAFF_AVAILABLE',
      taskId: maintenanceTask.id,
      message: `No available staff for ${maintenanceTask.type} task`
    })
  }
}
```

**–ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:**
- –°–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è (—Å–∞–Ω—Ç–µ—Ö–Ω—ñ–∫, –µ–ª–µ–∫—Ç—Ä–∏–∫, —Ç–æ—â–æ)
- –î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –Ω–∞ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—É –¥–∞—Ç—É
- –ì–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∞ –±–ª–∏–∑—å–∫—ñ—Å—Ç—å –¥–æ –æ–±'—î–∫—Ç–∞
- –ü–æ—Ç–æ—á–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- –†–µ–π—Ç–∏–Ω–≥ —è–∫–æ—Å—Ç—ñ —Ä–æ–±–æ—Ç–∏

### üìÖ **–ï—Ç–∞–ø 3: –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–ø–ª–∏–≤ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å**

**–ü—Ä–æ—Ü–µ—Å –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è:**
```typescript
const scheduleMaintenanceTask = (maintenanceTask) => {
  // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è–º–∏
  const conflictingReservations = getConflictingReservations({
    propertyId: maintenanceTask.propertyId,
    startDate: maintenanceTask.scheduledDate,
    endDate: maintenanceTask.estimatedCompletionDate
  })
  
  if (conflictingReservations.length > 0) {
    // –ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ –¥–∞—Ç–∏
    const alternativeDates = findAlternativeDates(maintenanceTask)
    notifyManager({
      type: 'SCHEDULE_CONFLICT',
      taskId: maintenanceTask.id,
      conflicts: conflictingReservations,
      alternatives: alternativeDates
    })
  }
  
  // 2. –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
  if (maintenanceTask.blocksProperty) {
    createSchedulerEvent({
      propertyId: maintenanceTask.propertyId,
      eventType: 'MAINTENANCE_BLOCK',
      startDate: maintenanceTask.scheduledDate,
      endDate: maintenanceTask.estimatedCompletionDate,
      title: `Maintenance: ${maintenanceTask.title}`,
      status: 'ACTIVE'
    })
  }
  
  // 3. –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≥–æ—Å—Ç–µ–π (—è–∫—â–æ —î –∞–∫—Ç–∏–≤–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è)
  if (maintenanceTask.affectsGuests) {
    notifyAffectedGuests(maintenanceTask)
  }
}
```

### ‚úÖ **–ï—Ç–∞–ø 4: –í–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ**

**–ü—Ä–æ—Ü–µ—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:**
```typescript
const executeMaintenanceTask = (maintenanceTask) => {
  // 1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –Ω–∞ "In Progress"
  updateMaintenanceTask(maintenanceTask.id, { status: 'IN_PROGRESS' })
  
  // 2. –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ —Ä–æ–±—ñ—Ç
  notifyStakeholders({
    type: 'MAINTENANCE_STARTED',
    task: maintenanceTask,
    message: `Maintenance work started: ${maintenanceTask.title}`
  })
  
  // 3. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—É
  startProgressMonitoring(maintenanceTask.id)
}

const completeMaintenanceTask = (maintenanceTask, completionData) => {
  // 1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É
  updateMaintenanceTask(maintenanceTask.id, {
    status: 'COMPLETED',
    completedDate: new Date(),
    actualCost: completionData.cost,
    notes: completionData.notes,
    photos: completionData.photos
  })
  
  // 2. –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞
  if (maintenanceTask.blocksProperty) {
    removeSchedulerBlock(maintenanceTask.propertyId, maintenanceTask.id)
  }
  
  // 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ–π—Ç–∏–Ω–≥—É –≤–∏–∫–æ–Ω–∞–≤—Ü—è
  updateStaffRating(maintenanceTask.assignedUserId, completionData.quality)
  
  // 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
  if (maintenanceTask.type === 'PREVENTIVE') {
    scheduleNextMaintenance(maintenanceTask)
  }
}
```

---

## üîÑ **4. –í–ó–ê–Ñ–ú–û–ó–í'–Ø–ó–ö–ò –°–¢–ê–¢–£–°–Ü–í –¢–ê –¢–†–ò–ì–ï–†–ò**

### üìä **–ú–∞—Ç—Ä–∏—Ü—è –≤–ø–ª–∏–≤—É —Å—Ç–∞—Ç—É—Å—ñ–≤**

| –ó–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É | –í–ø–ª–∏–≤–∞—î –Ω–∞ | –î—ñ—è |
|---------------|------------|-----|
| `Reservation.status` ‚Üí `CONFIRMED` | `Cleaning.status` | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Pre-Arrival –∑–∞–≤–¥–∞–Ω–Ω—è |
| `Reservation.status` ‚Üí `CONFIRMED` | `Scheduler` | –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –¥–∞—Ç |
| `Reservation.status` ‚Üí `CONFIRMED` | `Message` | –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è |
| `Reservation.paymentStatus` ‚Üí `PAID` | `Reservation.status` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è |
| `Reservation.guestStatus` ‚Üí `CHECKED_IN` | `Cleaning.status` | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Post-Checkout –∑–∞–≤–¥–∞–Ω–Ω—è |
| `Reservation.guestStatus` ‚Üí `CHECKED_OUT` | `Transaction` | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∏–ø–ª–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫—É |
| `Cleaning.status` ‚Üí `COMPLETED` | `Property.isReadyForCheckIn` | –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ |
| `Maintenance.status` ‚Üí `IN_PROGRESS` | `Scheduler` | –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞ |
| `Maintenance.status` ‚Üí `COMPLETED` | `Scheduler` | –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞ |

### ‚ö° **–ö—Ä–∏—Ç–∏—á–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏ —Å–∏—Å—Ç–µ–º–∏**

**1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω—å:**
```typescript
// –ö–æ–ª–∏ –æ–ø–ª–∞—Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–∞
if (reservation.paymentStatus === 'PAID' && reservation.status === 'PENDING') {
  reservation.status = 'CONFIRMED'
  triggerReservationConfirmation(reservation)
}
```

**2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å:**
```typescript
// –ü—Ä–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
const triggerReservationConfirmation = (reservation) => {
  createCleaningTask({
    propertyId: reservation.propertyId,
    scheduledDate: reservation.checkIn - 1 day,
    type: 'Pre-Arrival',
    priority: 'HIGH'
  })
  
  createMaintenanceTask({
    propertyId: reservation.propertyId,
    scheduledDate: reservation.checkIn - 2 hours,
    type: 'INSPECTION',
    priority: 'HIGH'
  })
}
```

**3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è:**
```typescript
// –ü—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ç–∞—Ç—É—Å—É –≥–æ—Å—Ç—è
if (reservation.guestStatus === 'NO_SHOW') {
  notifyManager({
    type: 'GUEST_NO_SHOW',
    reservation: reservation,
    message: `Guest ${reservation.guest.name} did not show up for check-in`
  })
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è
  cancelCleaningTasks(reservation.id)
}
```

---

## üéØ **–í–ò–°–ù–û–í–ö–ò –¢–ê –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–á**

### ‚úÖ **–ü–ï–†–ï–í–ê–ì–ò –ü–û–¢–û–ß–ù–û–á –°–ò–°–¢–ï–ú–ò**
- **–ü–æ–≤–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è** –∫–ª—é—á–æ–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤
- **–Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏** –º—ñ–∂ –º–æ–¥—É–ª—è–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è** –∑–∞–≤–¥–∞–Ω—å
- **–§—ñ–Ω–∞–Ω—Å–æ–≤–∞ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å** –Ω–∞ –≤—Å—ñ—Ö –µ—Ç–∞–ø–∞—Ö

### ‚ö†Ô∏è **–ü–û–¢–ï–ù–¶–Ü–ô–ù–Ü –ü–û–õ–Ü–ü–®–ï–ù–ù–Ø**
- **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó** –¥–ª—è —Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤
- **–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤** –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É
- **–î–æ–¥–∞–≤–∞–Ω–Ω—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è** –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –ø–æ—Ç—Ä–µ–±
- **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ IoT** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

### üöÄ **–ù–ê–ü–†–Ø–ú–ö–ò –†–û–ó–í–ò–¢–ö–£**
- **–ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è** –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞–Ω–∏—Ö
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ü—ñ–Ω–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è** –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–æ–ø–∏—Ç—É
- **–†–æ–∑—É–º–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó** –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –ø—Ä–æ—Ü–µ—Å—ñ–≤
- **–ú–æ–±—ñ–ª—å–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫** –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É –Ω–∞ –æ–±'—î–∫—Ç–∞—Ö

**–°–∏—Å—Ç–µ–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –≤–∏—Å–æ–∫–∏–π —Ä—ñ–≤–µ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤—Å—ñ–º–∞ –∞—Å–ø–µ–∫—Ç–∞–º–∏ –±—ñ–∑–Ω–µ—Å—É –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ.** üè†‚ú®
