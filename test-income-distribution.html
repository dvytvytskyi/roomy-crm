<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Income Distribution</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #f97316; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #ea580c; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .error { color: red; margin-top: 5px; }
        .success { color: green; margin-top: 5px; }
        .loading { color: #666; }
        .income-display { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .income-item { display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: white; border-radius: 4px; }
        .calculation { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Income Distribution Functionality</h1>
        
        <div class="income-display">
            <h2>Current Income Distribution</h2>
            <div class="income-item">
                <span>Owner Income:</span>
                <span id="ownerIncome">70%</span>
            </div>
            <div class="income-item">
                <span>Roomy Agency Fee:</span>
                <span id="roomyAgencyFee">25%</span>
            </div>
            <div class="income-item">
                <span>Referring Agent:</span>
                <span id="referringAgent">5%</span>
            </div>
            <div class="income-item">
                <span>Total Profit:</span>
                <span id="totalProfit">$12,500</span>
            </div>
        </div>

        <div class="calculation">
            <h3>Calculations</h3>
            <div class="income-item">
                <span>Owner Payout:</span>
                <span id="ownerPayout">$8,750</span>
            </div>
            <div class="income-item">
                <span>Company Revenue:</span>
                <span id="companyRevenue">$3,750</span>
            </div>
            <div class="income-item">
                <span>Profit Formula:</span>
                <span id="profitFormula">70% Owner / 30% Company</span>
            </div>
        </div>
        
        <h2>Edit Income Distribution</h2>
        
        <div class="form-group">
            <label>Owner Income (%):</label>
            <input type="number" id="ownerIncomeInput" value="70" min="0" max="100" step="0.1">
        </div>
        
        <div class="form-group">
            <label>Roomy Agency Fee (%):</label>
            <input type="number" id="roomyAgencyFeeInput" value="25" min="0" max="100" step="0.1">
        </div>
        
        <div class="form-group">
            <label>Referring Agent (%):</label>
            <input type="number" id="referringAgentInput" value="5" min="0" max="100" step="0.1">
        </div>
        
        <div class="form-group">
            <label>Total Profit ($):</label>
            <input type="number" id="totalProfitInput" value="12500" min="0" step="0.01">
        </div>
        
        <div class="form-group">
            <label>Total Percentage:</label>
            <input type="text" id="totalPercentage" value="100%" readonly style="background: #f0f0f0;">
        </div>
        
        <button onclick="updateIncomeDistribution()" id="updateBtn">Update Income Distribution</button>
        
        <div id="result"></div>
    </div>

    <script>
        function updateIncomeDistribution() {
            const btn = document.getElementById('updateBtn');
            const result = document.getElementById('result');
            
            btn.disabled = true;
            btn.textContent = 'Updating...';
            result.innerHTML = '<div class="loading">Updating income distribution...</div>';
            
            try {
                const ownerIncome = parseFloat(document.getElementById('ownerIncomeInput').value) || 0;
                const roomyAgencyFee = parseFloat(document.getElementById('roomyAgencyFeeInput').value) || 0;
                const referringAgent = parseFloat(document.getElementById('referringAgentInput').value) || 0;
                const totalProfit = parseFloat(document.getElementById('totalProfitInput').value) || 0;
                
                const totalPercentage = ownerIncome + roomyAgencyFee + referringAgent;
                
                // Validate
                if (totalPercentage !== 100) {
                    throw new Error(`Total percentage must equal 100%. Current: ${totalPercentage}%`);
                }
                
                if (ownerIncome < 0 || ownerIncome > 100) {
                    throw new Error('Owner income must be between 0% and 100%');
                }
                
                if (roomyAgencyFee < 0 || roomyAgencyFee > 100) {
                    throw new Error('Roomy Agency Fee must be between 0% and 100%');
                }
                
                if (referringAgent < 0 || referringAgent > 100) {
                    throw new Error('Referring Agent must be between 0% and 100%');
                }
                
                if (totalProfit < 0) {
                    throw new Error('Total profit must be positive');
                }
                
                // Simulate API call
                setTimeout(() => {
                    // Update display
                    document.getElementById('ownerIncome').textContent = `${ownerIncome}%`;
                    document.getElementById('roomyAgencyFee').textContent = `${roomyAgencyFee}%`;
                    document.getElementById('referringAgent').textContent = `${referringAgent}%`;
                    document.getElementById('totalProfit').textContent = `$${totalProfit.toLocaleString()}`;
                    
                    // Update calculations
                    const ownerPayout = (totalProfit * ownerIncome) / 100;
                    const companyRevenue = (totalProfit * (roomyAgencyFee + referringAgent)) / 100;
                    const companyPercentage = 100 - ownerIncome;
                    
                    document.getElementById('ownerPayout').textContent = `$${ownerPayout.toLocaleString()}`;
                    document.getElementById('companyRevenue').textContent = `$${companyRevenue.toLocaleString()}`;
                    document.getElementById('profitFormula').textContent = `${ownerIncome}% Owner / ${companyPercentage}% Company`;
                    
                    result.innerHTML = `
                        <div class="success">
                            <h3>Success!</h3>
                            <p>Income distribution updated successfully</p>
                            <p>Owner Payout: $${ownerPayout.toLocaleString()}</p>
                            <p>Company Revenue: $${companyRevenue.toLocaleString()}</p>
                        </div>
                    `;
                    
                    btn.disabled = false;
                    btn.textContent = 'Update Income Distribution';
                }, 1000);
                
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        <h3>Error!</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                btn.disabled = false;
                btn.textContent = 'Update Income Distribution';
            }
        }
        
        // Auto-update total percentage
        function updateTotalPercentage() {
            const ownerIncome = parseFloat(document.getElementById('ownerIncomeInput').value) || 0;
            const roomyAgencyFee = parseFloat(document.getElementById('roomyAgencyFeeInput').value) || 0;
            const referringAgent = parseFloat(document.getElementById('referringAgentInput').value) || 0;
            const total = ownerIncome + roomyAgencyFee + referringAgent;
            
            const totalInput = document.getElementById('totalPercentage');
            totalInput.value = `${total.toFixed(1)}%`;
            
            if (Math.abs(total - 100) < 0.01) {
                totalInput.style.background = '#d4edda';
                totalInput.style.color = '#155724';
            } else {
                totalInput.style.background = '#f8d7da';
                totalInput.style.color = '#721c24';
            }
        }
        
        // Add event listeners
        document.getElementById('ownerIncomeInput').addEventListener('input', updateTotalPercentage);
        document.getElementById('roomyAgencyFeeInput').addEventListener('input', updateTotalPercentage);
        document.getElementById('referringAgentInput').addEventListener('input', updateTotalPercentage);
        
        // Initial calculation
        updateTotalPercentage();
    </script>
</body>
</html>
